<?xml version="1.0"?>
<!-- Declaración XML que indica la versión del documento -->
<odoo>
  <!-- Definición de la acción de ventana para propiedades inmobiliarias -->
  <record id="estate_property_action" model="ir.actions.act_window">
   <field name="name">Propiedades</field> <!-- Nombre que aparecerá en el menú -->
   <field name="res_model">estate.property</field> <!-- Modelo de datos que se mostrará -->
   <field name="view_mode">list,form</field> <!-- Modos de vista disponibles: lista y formulario -->
   <field name="help" type="html"> <!-- Mensaje de ayuda cuando no hay registros -->
     <p class="o_view_nocontent_smiling_face">
         ¡Crea tu primera propiedad!
     </p>
     <p>
       Aquí puedes crear y gestionar todas tus propiedades inmobiliarias.
     </p>
     <p>
       ¡Vamos a conseguir ese próximo gran trato!
     </p>
    </field>
  </record>

  <!-- Definición de la vista de lista para propiedades inmobiliarias -->
  <record id="estate_property_view_list" model="ir.ui.view">
  <field name="name">estate.property.list</field> <!-- Nombre técnico de la vista -->
  <field name="model">estate.property</field> <!-- Modelo asociado a esta vista -->
  <field name="arch" type ="xml"> <!-- Arquitectura de la vista en XML -->
       <list decoration-bf="state=='offer_accepted'" decoration-success="state=='offer_accepted'" decoration-danger="state=='canceled'" decoration-muted="state=='sold'"> <!-- Elemento raíz para la vista de lista -->
        <field name="name" string="Título"/> <!-- Campo de nombre con etiqueta personalizada -->
        <field name="property_type_id" string="Tipo de Propiedad"/> 
        <field name="postcode" string="Código Postal"/> <!-- Campo de código postal -->
        <field name="bedrooms" string="Habitaciones"/> <!-- Campo de número de habitaciones -->
        <field name="living_area" string="Área Habitable (sqm)"/> <!-- Campo de área habitable -->
        <field name="expected_price" string="Precio Esperado" sum="Total Esperado"/>
        <field name="selling_price" string="Precio de Venta" sum="Total Vendido"/> <!-- Campo de precio de venta -->
        <field name="date_availability" string="Disponible Desde" widget="date"/> <!-- Campo de fecha de disponibilidad -->
        <field name="state" string="Estado" widget="badge" decoration-info="state == 'new'" decoration-success="state == 'offer_accepted'" decoration-warning="state == 'offer_received'" decoration-danger="state == 'canceled'" decoration-muted="state == 'sold'"/>
       </list> 
   </field>
  </record>

  <!-- Definición de la vista de formulario para propiedades inmobiliarias -->
  <record id="estate_property_view_form" model="ir.ui.view">
  <field name="name">estate.property.form</field>
  <field name="model">estate.property</field>
  <field name="arch" type="xml">
    <form string="Propiedad">
       <header>
        <button name="action_sold" type="object" string="Vendido"/>
        <button name="action_cancel" type="object" string="Cancelar"/>
        <!--statusbar: para que no se pueda editar el estado de la propiedad-->
        <field name="state" widget="statusbar" statusbar_visible="new,offer_received,offer_accepted,sold"/>
       </header>
      <sheet>
        <widget name="web_ribbon" title="Archivado" bg_color="text-bg-danger" invisible="active"/>
        <div class="oe_button_box" name="button_box">
          <button class="oe_stat_button" type="object" name="toggle_active" icon="fa-archive">
            <field name="active" widget="boolean_button" options="{'terminology': 'archivar'}"/>
          </button>
        </div>
        <group>
          <group string="Información General">
            <field name="tags_ids" widget="many2many_tags" class="pb-3" string="Etiquetas" />
            <field name="name" string="Nombre"/>
            <field name="postcode" string="Código Postal"/>
            <field name="property_type_id" string="Tipo de Propiedad" options="{'no_create': true, 'no_open': true}" widget="selection"/>
            <field name="state" groups="base.group_no_one" string="Estado"/>
          </group>

          <group string="Información Comercial">
            <field name="expected_price" string="Precio Esperado"/>
            <field name="selling_price" string="Precio de Venta"/>
            <field name="best_price" string="Mejor Oferta"/> <!-- Añadido el campo mejor oferta -->
            <field name="date_availability" string="Fecha de Disponibilidad"/>
          </group>      
        </group>

        <notebook>
          <page string="Descripción">
            <field name="description" string="Descripción"/>
            <group>
             <field name="bedrooms" string="Habitaciones"/>
              <field name="living_area" string="Área Habitable"/>
              <field name="facades" string="Fachadas"/> 
            </group>
            <group>
              <field name="garage" string="Garaje"/>
              <field name="garden" string="Jardín"/>
            </group>
            <group>
              <field name="garden_area" string="Área del Jardín"/>
              <field name="garden_orientation" string="Orientación del Jardín"/>
              <field name="total_area" string="Área Total"/>
            </group>
          </page>
          <page string="Otra Información"> 
            <group>
              <field name="salesperson_id" widget="selection" options="{'no_create': True}" string="Vendedor"/>
              <field name="buyer_id" widget="selection" options="{'no_create': True}" string="Comprador"/>
            </group>
          </page>
          <page string="Ofertas">
            <field name="offer_ids" string="Ofertas" context="{'default_property_id': id}">
              <list editable="bottom">
                <field name="price" string="Precio" width="100"/>
                <field name="partner_id" string="Cliente" widget="selection" options="{'no_create': True}" width="100"/>
                <field name="validity" string="Validez" width="100"/>
                <field name="date_deadline" string="Fecha Límite" width="100"/>
                <button name="action_accept" type="object" string="Aceptar" icon="fa-check" class="btn btn-success"/>
                <button name="action_refuse" type="object" string="Rechazar" icon="fa-times" class="btn btn-danger"/>
                <field name="status" string="Estado" width="100"/>
              </list>
            </field>
          </page>
        </notebook>
      </sheet>
    </form>
  </field>
  </record>

  
  <!-- Definición de la vista de filtro para propiedades inmobiliarias -->
  <record id="estate_property_view_search_filter" model="ir.ui.view">
    <field name="name">estate.property.view.search.filter</field>
    <field name="model">estate.property</field>
    <field name="arch" type="xml">
      <search>
        <field name="name" string="Nombre"/>
        <field name="postcode" string="Código Postal"/>
         <field name="property_type_id" string="Tipo de Propiedad"/>
        <field name="bedrooms" string="Habitaciones"/>
        <field name="living_area" string="Área Habitable"/>
        <field name="selling_price" string="Precio de Venta"/>
        <field name="best_price" string="Mejor Oferta"/> <!-- Añadido el campo mejor oferta -->
        <separator/>
        <filter string="Disponible" name="available" domain="[('state', 'in', ['new', 'offer_received'])]"/>
        <filter string="Vendido" name="sold" domain="[('state', '=', 'sold')]"/>
        <separator/>
        <filter string="Con Jardín" name="with_garden" domain="[('garden', '=', True)]"/>
        <filter string="Con Garaje" name="with_garage" domain="[('garage', '=', True)]"/>
        <separator/>
        <filter string="Archivado" name="inactive" domain="[('active', '=', False)]"/>
        <group expand="1" string="Agrupar Por">
          <filter string="Estado" name="groupby_state" context="{'group_by': 'state'}"/>
          <filter string="Código Postal" name="groupby_postcode" context="{'group_by': 'postcode'}"/>
        </group>
      </search>
    </field>
  </record>

</odoo>